# Sample JOB definition for a juno u-boot tftp busybox job

device_type: juno

job_name: juno-uboot-oe-pipeline
timeouts:
  job:
    minutes: 15            # timeout for the whole job (default: ??h)
  action:
   minutes: 5         # default timeout applied for each action; can be overriden in the action itself (default: ?h)
priority: medium

actions:

  - deploy:
     timeout:
       minutes: 2
     to: tftp
     namespace: master-image
     kernel:
         url: http://images.validation.linaro.org/juno/kernel/Image
     os: oe
     dtb:
         url: http://images.validation.linaro.org/juno/kernel/juno.dtb
     nfsrootfs:
         url: http://releases.linaro.org/openembedded/juno-lsk/16.02/linaro-image-minimal-genericarmv8-20160222-790.rootfs.tar.gz
         compression: gz

  - boot:
     method: u-boot
     namespace: master-image
     commands: tftp
     type: bootz
     parameters:
       shutdown-message: "reboot: Restarting system"
     prompts:
       - '/ #'
       - 'linaro-test'
       - 'root@debian:~#'
       - 'root@genericarmv8:~#'

  - test:
     namespace: master-image
     failure_retry: 3
     name: juno-basics
     timeout:
       minutes: 5
     definitions:
         - repository: git://git.linaro.org/qa/test-definitions.git
           from: git
           path: openembedded/smoke-tests-basic.yaml
           name: smoke-tests

  - deploy:
     timeout:
       minutes: 10
     to: usb
     namespace: test-image
     os: oe
     # do NOT use the name image as this breaks during download action
     image:
         url: http://releases.linaro.org/openembedded/juno-lsk/16.02/lt-vexpress64-openembedded_minimal-armv8-gcc-5.2_20160121-736.img.gz
         compression: gz
     device: Kingston_DataTraveler # needs to be exposed in the device-specific UI
     download:
         tool: /usr/bin/wget
         options: --no-check-certificate --no-proxy --connect-timeout=30 -S --progress=dot:giga -O - {DOWNLOAD_URL}

  - boot:
     method: u-boot
     namespace: test-image
     commands: use-defaults
     type: bootz
     parameters:
       shutdown-message: "reboot: Restarting system"
     prompts:
       - '/ #'
       - 'linaro-test'
       - 'root@debian:~#'
       - 'root@genericarmv8:~#'

  - test:
     namespace: test-image
     failure_retry: 3
     name: juno-basics
     timeout:
       minutes: 5
     definitions:
         - repository: git://git.linaro.org/qa/test-definitions.git
           from: git
           path: openembedded/smoke-tests-basic.yaml
           name: smoke-tests
